<div class="addEvent">
  <form class="form" [formGroup]="addEventForm" (ngSubmit)="addEvent()">
    <h3>Add new event</h3>

    <div class="form-group">
      <label for="name" class="required">Event name</label>
      <input type="text" name="name" formControlName="name" class="text-input form-control" id="name"
             placeholder="Enter event name">
      <div *ngIf="submitted && addEventForm.controls.name.errors" class="error">
        <small class="form-text text-danger" *ngIf="addEventForm.controls.name.errors.required">
          Event name is required!
        </small>
        <small class="form-text text-danger" *ngIf="addEventForm.controls.name.errors.maxLength">
          Event name cannot be more than 100 characters!
        </small>
      </div>
    </div>
    <div class="form-group">
      <label for="description" class="required">Description</label>
      <textarea name="description" formControlName="description" rows="3" class="text-input form-control"
                id="description" placeholder="Enter description"></textarea>
      <div *ngIf="submitted && addEventForm.controls.description.errors" class="error">
        <small class="form-text text-danger" *ngIf="addEventForm.controls.description.errors.required">
          Description is required!
        </small>
        <small class="form-text text-danger" *ngIf="addEventForm.controls.description.errors.maxLength">
          Description cannot be more than 100 characters!
        </small>
      </div>
    </div>
    <div class="form-group">
      <label for="duration" class="required">Duration (in minutes)</label>
      <input type="number" name="duration" formControlName="duration" class="text-input form-control" id="duration">
      <div *ngIf="submitted && addEventForm.controls.duration.errors" class="error">
        <small class="form-text text-danger" *ngIf="addEventForm.controls.duration.errors.required">
          Duration is
          required!
        </small>
        <small class="form-text text-danger" *ngIf="addEventForm.controls.duration.errors.min">
          Duration must be greater than 0!
        </small>
      </div>
    </div>
    <div class="form-group">
      <label for="eventType" class="required">Eventtype</label>
      <select name="eventType" id="eventType" formControlName="eventType" class="select-input form-select">
        <option value="CONCERT">Concert</option>
        <option value="OPERA">Opera</option>
        <option value="CINEMA">Cinema</option>
        <option value="THEATRE">Theatre</option>
      </select>
      <div *ngIf="submitted && addEventForm.controls.eventType.errors" class="error">
        <small class="form-text text-danger" *ngIf="addEventForm.controls.eventType.errors.required">
          Eventtype is
          required!
        </small>
      </div>
    </div>

    <div class="row">
      <div class="form-group col-6">
        <label for="startDate" class="required">Start date</label>
        <input type="datetime-local" name="startDate" formControlName="startDate" class="text-input form-control" id="startDate">
        <div *ngIf="submitted && addEventForm.controls.startDate.errors" class="error">
          <small class="form-text text-danger" *ngIf="addEventForm.controls.startDate.errors.required">
            Start date is required!
          </small>
          <small class="form-text text-danger" *ngIf="addEventForm.controls.startDate.errors.invalidDate">
            Start date must be in the future!
          </small>
        </div>
      </div>
      <div class="form-group col-6">
        <label for="endDate" class="required">End date</label>
        <input type="datetime-local" name="endDate" formControlName="endDate" class="text-input form-control" id="endDate">
        <div *ngIf="submitted && addEventForm.controls.endDate.errors" class="error">
          <small class="form-text text-danger" *ngIf="addEventForm.controls.endDate.errors.required">
            End date is required!
          </small>
          <small class="form-text text-danger" *ngIf="addEventForm.controls.endDate.errors.invalidDate">
            End date must be after start date!
          </small>
        </div>
      </div>

      <hr/>

      <h4>Performances</h4>
      <div *ngIf="performances.length === 0" class="fst-italic">
        No performances added yet
      </div>
      <div *ngIf="performances.length > 0">
        <table class="table">
          <tr>
            <th>Name</th>
            <th>Date</th>
            <th>Artist</th>
          </tr>
          <tbody>
          <tr *ngFor="let performance of performances; let i = index">
            <td>{{performance.title}}</td>
            <td>{{performance.date}}</td>
            <td>{{performance.artist.firstName}} {{performance.artist.lastName}}</td>
            <td><button type="button" class="btn btn-secondary" style="width: 100%"
                        (click)="removePerformance(i)">X</button></td>
          </tr>
          </tbody>
        </table>
      </div>

      <div *ngIf="performances.length === 0 && submitted" class="alert alert-danger">
        Atleast one performance required!
      </div>

      <div class="col-3">
        <button *ngIf="!addingPerformance" class="primary" type="button" (click)="addingPerformance = true">Add performance</button>
      </div>
      <div *ngIf="addingPerformance">
        <app-add-performance [event]="event" (performanceAdded)="addPerformance($event)"></app-add-performance>
      </div>
    </div>
    <div class="offset-4 col-4">
      <button type="submit" class="primary">Create new event</button>
    </div>
  </form>
</div>
